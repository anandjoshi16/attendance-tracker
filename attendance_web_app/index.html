<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Attendance Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#4facfe,#00f2fe); margin:0; padding:0; color:#333; }
    .container { max-width:550px; margin:40px auto; background:#fff; padding:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
    h2 { text-align:center; margin-bottom:20px; color:#222; }
    input,select,button { width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:10px; font-size:16px; }
    button { background:#4facfe; color:white; border:none; cursor:pointer; font-weight:bold; }
    button:hover { background:#00c6fb; }
    .hidden { display:none; }
    table { width:100%; border-collapse:collapse; margin:15px 0; font-size:14px; }
    th,td { border:1px solid #ddd; padding:6px; text-align:center; }
    th { background:#4facfe; color:white; }
    .footer { text-align:center; padding:15px; font-size:14px; color:#fff; }
  </style>
</head>
<body>

<div class="container" id="loginBox">
  <h2>Login</h2>
  <input type="text" id="loginId" placeholder="Enter ID">
  <input type="password" id="loginPass" placeholder="Enter Password">
  <button onclick="login()">Login</button>
</div>

<!-- Admin Panel -->
<div class="container hidden" id="adminPanel">
  <h2>Admin Dashboard</h2>
  <h3>Staff Attendance</h3>
  <table id="attendanceTable">
    <thead>
      <tr><th>Name</th><th>Date</th><th>Status</th><th>In</th><th>Out</th><th>Hours</th><th>Advance</th></tr>
    </thead>
    <tbody id="attendanceBody"></tbody>
  </table>
  <h3>Mark Attendance</h3>
  <select id="staffSelect"></select>
  <select id="statusSelect">
    <option value="Present">Present</option>
    <option value="Absent">Absent</option>
  </select>
  <input type="time" id="timeInInput" placeholder="Time In">
  <input type="time" id="timeOutInput" placeholder="Time Out">
  <input type="number" id="advanceInput" placeholder="Advance (if any)">
  <button onclick="markAttendance(true)">Save Attendance</button>
  <hr>
  <button onclick="downloadReport('daily')">Download Daily Report</button>
  <button onclick="downloadReport('monthly')">Download Monthly Report</button>
  <button onclick="logout()">Logout</button>
</div>

<!-- Staff Panel -->
<div class="container hidden" id="staffPanel">
  <h2>Staff Panel</h2>
  <p id="staffName"></p>
  <button onclick="markAttendance(false,'Present')">Mark Present (Auto Time)</button>
  <button onclick="markAttendance(false,'Absent')">Mark Absent</button>
  <button onclick="logout()">Logout</button>
</div>

<div class="footer">Made by Anand Joshi</div>

<script>
  const staffList = ["Anand","Uttam","Sunil","Pravin","Alpesh","Raj","Piyush","Vishwa"];
  let attendanceData = JSON.parse(localStorage.getItem("attendanceData") || "[]");
  let currentUser = null, currentRole = null;

  function login(){
    const id=document.getElementById("loginId").value.trim();
    const pass=document.getElementById("loginPass").value.trim();

    if(id==="anandjoshi@123" && pass==="6508"){ 
      currentRole="admin"; 
      showAdmin(); 
    }
    else if(id==="anand@123" && pass==="1515"){ 
      currentRole="staff"; 
      currentUser="Anand"; 
      showStaff(); 
    }
    else { 
      alert("Invalid Credentials!"); 
    }
  }

  function showAdmin(){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    loadStaffSelect();
    renderTable();
  }
  function showStaff(){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("staffPanel").classList.remove("hidden");
    document.getElementById("staffName").innerText="Welcome, "+currentUser;
  }
  function logout(){ location.reload(); }

  function loadStaffSelect(){
    let sel=document.getElementById("staffSelect"); sel.innerHTML="";
    staffList.forEach(s=>{ 
      let opt=document.createElement("option"); 
      opt.value=s; opt.text=s; 
      sel.appendChild(opt); 
    });
  }

  // Utility: always YYYY-MM-DD
  function getToday(){
    return new Date().toISOString().split("T")[0];
  }

  function calcHours(inTime,outTime){
    if(!inTime || !outTime) return "";
    let [h1,m1]=inTime.split(":").map(Number);
    let [h2,m2]=outTime.split(":").map(Number);
    let t1=h1*60+m1, t2=h2*60+m2;
    if(t2<t1) return "Invalid"; // out < in
    let diff=t2-t1;
    return (Math.floor(diff/60)+"h "+(diff%60)+"m");
  }

  function markAttendance(isAdmin,statusOverride=null){
    const today=getToday();
    let name, status, inTime, outTime;
    if(isAdmin){
      name=document.getElementById("staffSelect").value;
      status=document.getElementById("statusSelect").value;
      inTime=document.getElementById("timeInInput").value;
      outTime=document.getElementById("timeOutInput").value;
    } else {
      name=currentUser; 
      status=statusOverride;
      let now=new Date().toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
      inTime=now; outTime=""; // staff panel auto in
    }

    let record=attendanceData.find(r=>r.name===name && r.date===today);
    if(!record){
      record={name,date:today,status,timeIn:"",timeOut:"",hours:"",advance:0};
      attendanceData.push(record);
    }
    record.status=status;
    if(status==="Present"){
      if(inTime) record.timeIn=inTime;
      if(outTime) record.timeOut=outTime;
      record.hours=calcHours(record.timeIn,record.timeOut);
    }
    if(isAdmin){
      let adv=parseInt(document.getElementById("advanceInput").value||0);
      if(adv>0) record.advance=adv;
    }

    localStorage.setItem("attendanceData",JSON.stringify(attendanceData));
    if(isAdmin) renderTable();
    alert("Attendance saved for "+name);
  }

  function renderTable(){
    let body=document.getElementById("attendanceBody"); body.innerHTML="";
    attendanceData.forEach(r=>{
      let tr=document.createElement("tr");
      tr.innerHTML=`<td>${r.name}</td><td>${r.date}</td><td>${r.status}</td><td>${r.timeIn||""}</td><td>${r.timeOut||""}</td><td>${r.hours||""}</td><td>${r.advance}</td>`;
      body.appendChild(tr);
    });
  }

  function downloadReport(type){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(14);
    doc.text("Staff Attendance Report ("+type+")",20,20);

    let filtered=attendanceData;
    const today=getToday();

    if(type==="daily"){ 
      filtered=attendanceData.filter(r=>r.date===today); 
    }
    else if(type==="monthly"){ 
      let month=new Date().getMonth();
      filtered=attendanceData.filter(r=>{
        return new Date(r.date).getMonth()===month;
      });
    }

    let y=40;
    if(filtered.length===0){ 
      doc.text("No records found.",20,y); 
    } else {
      filtered.forEach(r=>{
        doc.text(`${r.date} | ${r.name} | ${r.status} | In: ${r.timeIn} | Out: ${r.timeOut} | Hrs: ${r.hours} | Adv: ${r.advance}`,20,y);
        y+=10;
      });
    }
    doc.save(`${type}_report.pdf`);
  }
</script>
</body>
</html>
