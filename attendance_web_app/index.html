<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Attendance Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 0;
      margin: 0;
      background: #121212;
      color: #fff;
    }
    header {
      background: #1f1f1f;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      border-bottom: 2px solid #333;
    }
    .container {
      padding: 20px;
    }
    .inputRow {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    input, select, button {
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 14px;
    }
    input[type="text"], input[type="time"], input[type="date"] {
      background: #333;
      color: #fff;
      border: 1px solid #444;
    }
    button {
      background: #03dac6;
      color: #000;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #1f1f1f;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #272727;
    }
    footer {
      text-align: center;
      padding: 15px;
      color: #bbb;
      font-size: 14px;
      border-top: 1px solid #444;
      margin-top: 30px;
    }
    .adminBox {
      max-width: 300px;
      margin: 50px auto;
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #333;
    }
    #attendanceSection {
      display: none;
    }
  </style>
</head>
<body>
  <header>üìÖ Staff Attendance Tracker</header>

  <div id="adminLogin" class="adminBox">
    <h3>üîê Admin Login</h3>
    <input type="password" id="adminPassword" placeholder="Enter 4-digit Password" maxlength="4">
    <br><br>
    <button onclick="loginAdmin()">Login</button>
    <p id="loginMsg" style="color:red;"></p>
  </div>

  <div class="container" id="attendanceSection">
    <div class="inputRow">
      <input type="date" id="entryDate">
      <input type="time" id="timeIn" placeholder="Time In">
      <input type="time" id="timeOut" placeholder="Time Out">
      <input type="text" id="staffName" placeholder="Staff Name">
      <button onclick="markAttendance()">Mark Today</button>
    </div>

    <table id="attendanceTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Staff Name</th>
          <th>Time In</th>
          <th>Time Out</th>
          <th>Total Hours</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="downloadPDF()">üì• Download Weekly Report (PDF)</button>
  </div>

  <footer>Made by Anand Joshi</footer>

  <script>
    const passcode = "6508";
    const tableBody = document.querySelector("#attendanceTable tbody");

    function loginAdmin() {
      const pass = document.getElementById("adminPassword").value;
      if (pass === passcode) {
        document.getElementById("adminLogin").style.display = "none";
        document.getElementById("attendanceSection").style.display = "block";
        loadData();
      } else {
        document.getElementById("loginMsg").innerText = "‚ùå ‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!";
      }
    }

    function markAttendance() {
      const date = document.getElementById("entryDate").value;
      const name = document.getElementById("staffName").value;
      const inTime = document.getElementById("timeIn").value;
      const outTime = document.getElementById("timeOut").value;

      if (!date || !name || !inTime || !outTime) return alert("Please fill all fields.");

      let data = JSON.parse(localStorage.getItem("attendance") || "[]");

      const existing = data.find(d => d.date === date && d.name === name);
      if (existing) return alert("Entry already exists for this staff today.");

      const hours = calcTotalHours(inTime, outTime);
      data.push({ date, name, inTime, outTime, hours });
      localStorage.setItem("attendance", JSON.stringify(data));
      loadData();
    }

    function loadData() {
      tableBody.innerHTML = "";
      const data = JSON.parse(localStorage.getItem("attendance") || "[]");
      data.forEach((entry, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="date" value="${entry.date}" onchange="editEntry(${i}, 'date', this.value)"></td>
          <td><input type="text" value="${entry.name}" onchange="editEntry(${i}, 'name', this.value)"></td>
          <td><input type="time" value="${entry.inTime}" onchange="editEntry(${i}, 'inTime', this.value)"></td>
          <td><input type="time" value="${entry.outTime}" onchange="editEntry(${i}, 'outTime', this.value)"></td>
          <td>${entry.hours}</td>
          <td><button onclick="deleteEntry(${i})">‚ùå</button></td>
        `;
        tableBody.appendChild(row);
      });
    }

    function editEntry(i, field, value) {
      const data = JSON.parse(localStorage.getItem("attendance"));
      data[i][field] = value;
      if (field === "inTime" || field === "outTime") {
        data[i].hours = calcTotalHours(data[i].inTime, data[i].outTime);
      }
      localStorage.setItem("attendance", JSON.stringify(data));
      loadData();
    }

    function deleteEntry(i) {
      if (confirm("Are you sure?")) {
        let data = JSON.parse(localStorage.getItem("attendance"));
        data.splice(i, 1);
        localStorage.setItem("attendance", JSON.stringify(data));
        loadData();
      }
    }

    function calcTotalHours(start, end) {
      const [h1, m1] = start.split(":".map(Number));
      const [h2, m2] = end.split(":".map(Number));
      let diff = (h2 * 60 + m2) - (h1 * 60 + m1);
      if (diff < 0) diff += 1440;
      return `${Math.floor(diff / 60)}h ${diff % 60}m`;
    }

    function downloadPDF() {
      const data = JSON.parse(localStorage.getItem("attendance") || "[]");
      const doc = new jspdf.jsPDF();
      doc.setFontSize(12);
      doc.text("Weekly Attendance Report", 20, 20);

      let y = 30;
      data.forEach(d => {
        doc.text(`${d.date} - ${d.name} - In: ${d.inTime}, Out: ${d.outTime}, Total: ${d.hours}`, 20, y);
        y += 10;
      });

      doc.save("weekly_attendance.pdf");
    }
  </script>
</body>
</html>
